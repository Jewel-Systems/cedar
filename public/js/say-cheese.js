var SayCheese=function(){var t;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||!1,window.AudioContext=window.AudioContext||window.webkitAudioContext,window.URL=window.URL||window.webkitURL;var i={NOT_SUPPORTED:"NOT_SUPPORTED",AUDIO_NOT_SUPPORTED:"AUDIO_NOT_SUPPORTED"};return t=function(t,i){return this.snapshots=[],this.video=null,this.events={},this.stream=null,this.options={videoSource:null,snapshots:!0,audio:!1,width:320},this.setOptions(i),this.element=document.querySelector(t),console.log("Initialized"),this},t.prototype.on=function(t,i){this.events.hasOwnProperty(t)===!1&&(this.events[t]=[]),this.events[t].push(i)},t.prototype.off=function(t,i){this.events[t]=this.events[t].filter(function(t){return t!==i})},t.prototype.trigger=function(t,i){return this.events.hasOwnProperty(t)!==!1&&void this.events[t].forEach(function(t){t.call(this,i)}.bind(this))},t.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},t.prototype.getStreamUrl=function(){return window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(this.stream):this.stream},t.prototype.createVideo=function(){console.log("creating video");var t=this.options.width,i=0,e=!1;this.video=document.createElement("video"),this.video.addEventListener("canplay",function(){if(!e)return i=this.video.videoHeight/(this.video.videoWidth/t),this.video.width=t,this.video.height=i,e=!0,this.trigger("start")}.bind(this),!1)},t.prototype.linkAudio=function(){this.audioCtx=new window.AudioContext,this.audioStream=this.audioCtx.createMediaStreamSource(this.stream);var t=this.audioCtx.createBiquadFilter();this.audioStream.connect(t),t.connect(this.audioCtx.destination)},t.prototype.takeSnapshot=function(t,i){if(this.options.snapshots===!1)return!1;t=t||this.video.videoWidth,i=i||this.video.videoHeight;var e=document.createElement("canvas"),o=e.getContext("2d");e.width=t,e.height=i,o.drawImage(this.video,0,0,t,i),this.snapshots.push(e),this.trigger("snapshot",e),o=null},t.prototype.start=function(){if(console.log("starting say-cheese..."),navigator.getUserMedia===!1)return console.log("failing fast and softly..."),this.trigger("error",i.NOT_SUPPORTED),!1;var t=function(t){if(console.log("Success!"),this.stream=t,this.createVideo(),navigator.mozGetUserMedia?this.video.mozSrcObject=t:this.video.src=this.getStreamUrl(),this.options.audio===!0)try{this.linkAudio()}catch(t){this.trigger("error",i.AUDIO_NOT_SUPPORTED)}this.element.appendChild(this.video),this.video.play(),this.trigger("success")}.bind(this),e=function t(t){console.log("access denied"),this.trigger("error",t)}.bind(this);return console.log("Getting user media..."),navigator.getUserMedia({video:{optional:[{sourceId:this.options.videoSource}]},audio:this.options.audio},t,e)},t.prototype.stop=function(){return this.stream.stop(),window.URL&&window.URL.revokeObjectURL&&window.URL.revokeObjectURL(this.video.src),this.trigger("stop")},t}();