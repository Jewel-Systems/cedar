function getDevices(){$.ajaxSetup({error:AjaxError});var e=null;$.get(domain+"user",function(t,i){e=t.data,i=t.success,i?$.get(domain+"device",function(t,i){datas=t.data,i=t.success;var n=sessionStorage.perm.split("#"),a="";if(i){for(var d=0;d<datas.length;d++)if(device=datas[d],n[0]==device.type||n[1]==device.type)if("student"==sessionStorage.user_type){if(device.is_active&&null===device.loaned_by){var s=sessionStorage.device_loaned.split("#");if(1===s.length){$(".available-devices").fadeIn();var r=s[0].split(":");device.type!=r[0]&&(a+="<tr>",a+="<td>"+device.id+"</td>",a+="<td>"+device.type+"</td>",a+="<td>",a+='<form class="pull-right" id="device" method="post">',a+='<input type="hidden" name="device_id" value="'+device.id+'" />',a+='<input id="rent" type="submit" class="btn btn-info" name="rent" value="Rent Device" />',a+="</form>",a+="</td>",a+="</tr>")}else $(".available-devices").fadeOut()}}else if("admin"==sessionStorage.user_type||"teacher"==sessionStorage.user_type&&device.is_active===!0&&(device.loaned_by==sessionStorage.user_id||null===device.loaned_by)){var c,l=new Date(device.created_at),v=device.id,o=device.type,u=device.is_active,p=device.loaned_by;l=l.getDate()+" "+convertMonth(l.getMonth())+" "+l.getFullYear()+", "+l.getHours()+"h"+l.getMinutes(),a+="<tr>",a+="<td>"+v+"</td>",a+="<td>"+o+"</td>",a+='<td class="admin">'+u+"</td>";for(var m=0;m<e.length;m++)e[m].id===p?c="["+e[m].id+"]: "+e[m].fname+" "+e[m].lname:null===p&&(c="Not loaned");a+='<td class="admin teacher">'+c+"</td>",a+='<td class="admin">'+l+"</td>",a+="<td>",a+='<form class="pull-right" id="device" method="post">',a+='<input type="hidden" name="device_id" value="'+v+'" />',a+='<input type="hidden" name="device_active" value="'+u+'" />',a+=null===p&&u===!0?'<input type="submit" id="rent" class="btn btn-info" name="rent" value="Rent Device" />&nbsp;':'<input type="submit" id="rent" class="btn btn-info" name="rent" value="Rent Device" disabled="disabled" />&nbsp;',a+='<input type="submit" id="active" class="btn btn-warning admin" name="active" value="Toggle Active" />&nbsp;',a+='<input type="submit" id="delete" class="btn btn-danger admin" name="delete" value="Delete" />',a+="</form>",a+="</td>",a+="</tr>"}}else a+="Can't retrieve devices from server";a+='<script type="text/javascript" src="js/device/actions.js"></script>',$(".content table.available-devices tbody").append(a)}):errorMsg("Couldn't retrieve users from the server.")})}function AjaxError(e,t){0===e.status?errorMsg("The server might be down"):404==e.status?errorMsg("Requested URL not found. Server could be offline."):500==e.status?errorMsg("Internal Server Error."):errorMsg("Unknown Error.\n"+e.responseText+".")}