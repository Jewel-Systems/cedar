function getDevices(){$.ajaxSetup({error:AjaxError});var e=null;$.get(domain+"user",function(t,i){e=t.data,i=t.success,i?$.get(domain+"device",function(t,i){datas=t.data,i=t.success;var n=sessionStorage.perm.split("#"),d="";if(i){for(var s=0;s<datas.length;s++)if(device=datas[s],n[0]==device.type||n[1]==device.type)if("student"==sessionStorage.user_type){if(device.is_active&&null===device.loaned_by){var a=sessionStorage.device_loaned.split("#");if(1===a.length){$(".available-devices").fadeIn();var r=a[0].split(":");device.type!=r[0]&&(d+="<tr>",d+="<td>"+device.id+"</td>",d+="<td>"+device.type+"</td>",d+="<td>",d+='<form class="pull-right" id="device" method="post">',d+='<input type="hidden" name="device_id" value="'+device.id+'" />',d+='<input id="rent" type="submit" class="btn btn-info" name="rent" value="Rent Device" />',d+="</form>",d+="</td>",d+="</tr>")}else $(".available-devices").fadeOut()}}else if("admin"==sessionStorage.user_type||"teacher"==sessionStorage.user_type&&device.is_active===!0&&(device.loaned_by==sessionStorage.user_id||null===device.loaned_by)){var c,v=new Date(device.created_at),l=device.id,o=device.type,u=device.is_active,p=device.loaned_by;v=v.getDate()+" "+convertMonth(v.getMonth())+" "+v.getFullYear()+", "+v.getHours()+"h"+v.getMinutes(),d+="<tr>",d+="<td>"+l+"</td>",d+="<td>"+o+"</td>",d+='<td class="admin">'+u+"</td>";for(var m=0;m<e.length;m++)e[m].id===p?c="["+e[m].id+"]: "+e[m].fname:null===p&&(c="Not loaned");d+='<td class="admin teacher">'+c+"</td>",d+='<td class="admin">'+v+"</td>",d+="<td>",d+='<form class="pull-right" id="device" method="post">',d+='<input type="hidden" name="device_id" value="'+l+'" />',d+='<input type="hidden" name="device_active" value="'+u+'" />',d+=null===p&&u===!0?'<input type="submit" id="rent" class="btn btn-info" name="rent" value="Rent Device" />&nbsp;':'<input type="submit" id="rent" class="btn btn-info" name="rent" value="Rent Device" disabled="disabled" />&nbsp;',d+='<input type="submit" id="active" class="btn btn-warning admin" name="active" value="Toggle Active" />&nbsp;',d+='<input type="submit" id="delete" class="btn btn-danger admin" name="delete" value="Delete" />',d+="</form>",d+="</td>",d+="</tr>"}}else d+="Can't retrieve devices from server";d+='<script type="text/javascript" src="js/device/actions.js"></script>',$(".content table.available-devices tbody").append(d)}):errorMsg("Couldn't retrieve users from the server.")})}function AjaxError(e,t){0===e.status?errorMsg("The server might be down"):404==e.status?errorMsg("Requested URL not found. Server could be offline."):500==e.status?errorMsg("Internal Server Error."):errorMsg("Unknown Error.\n"+e.responseText+".")}