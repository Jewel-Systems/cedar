$(document).ready(function(){"undefined"!=typeof sessionStorage.email&&(window.location="/user"),$(".content .panel").fadeIn(1e3),$("form.loginForm").submit(function(e){var o=$(this).serializeArray();$.ajax({url:domain+"testauth",type:"POST",data:JSON.stringify({username:o[0].value,password:o[1].value}),contentType:"application/json",success:function(e,o,a){var n=e.data;"undefined"!=typeof Storage?(sessionStorage.user_id=n.id,sessionStorage.email=n.email,sessionStorage.fname=n.fname,sessionStorage.lname=n.lname,sessionStorage.user_type=n.type,sessionStorage.created_at=n.created_at,$.get(domain+"user/"+n.id,function(e){if(e=e.data,void 0!==e.loaned[0])if(e.loaned.length>1){console.log(e.loaned.length);for(var o=0;o<e.loaned.length;o++)void 0===sessionStorage.device_loaned?sessionStorage.device_loaned=e.loaned[o].type+":"+e.loaned[o].id:sessionStorage.device_loaned+="#"+e.loaned[o].type+":"+e.loaned[o].id}else 1===e.loaned.length&&(sessionStorage.device_loaned=e.loaned[0].type+":"+e.loaned[0].id);else sessionStorage.device_loaned=null;e.privilages.length>1?sessionStorage.perm=e.privilages[0].type+"#"+e.privilages[1].type:1===e.loaned.length&&(sessionStorage.perm=e.privilages[0].type),window.location="/user"})):errorMsg("Your browser doesn't support local storage, please update your browser or download <a href='https://www.google.com/chrome/'>Google Chrome</a>/<a href='https://www.mozilla.org/en-US/firefox/new/'>Mozilla Firefox</a>.")},error:function(e,o,a){try{JSON.parse(e.responseText);errorMsg("The email/ID or password entered is incorrect, please try again.")}catch(e){console.log(e)}}}),e.preventDefault()})});